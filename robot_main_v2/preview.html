<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>ESP32 Wall-E</title>
	<style>
		body { font-family: Arial, sans-serif; background: #111827; color: #f9fafb; margin: 0; padding: 16px; }
		h1 { margin: 0 0 16px; font-size: 1.4rem; }
		.layout { display: grid; gap: 14px; max-width: 760px; margin: 0 auto; }
		.card { background: #1f2937; border-radius: 12px; padding: 12px; }
		.card h2 { margin: 0 0 10px; font-size: 1rem; }
		.motion-wrap { display: grid; grid-template-columns: 1fr 170px; gap: 10px; align-items: start; }
		.pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
		.row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
		.arm-col { display: grid; grid-template-columns: 1fr; gap: 8px; }
		.arms-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px; }
		.speed-box { background: #111827; border-radius: 10px; padding: 10px; }
		.speed-box label { display: block; margin-bottom: 8px; font-size: 0.9rem; }
		.speed-box input[type="range"] { width: 100%; }
		.speed-value { margin-top: 6px; font-size: 0.9rem; opacity: 0.9; }
		button {
			border: 0; border-radius: 10px; padding: 12px; font-size: 0.95rem;
			background: #374151; color: #f9fafb; cursor: pointer;
		}
		button:active { transform: scale(0.98); }
		.empty { visibility: hidden; }
		.status { font-size: 0.9rem; opacity: 0.85; }
	</style>
</head>
<body>
	<div class="layout">
		<h1>ESP32 Wall-E</h1>

		<div class="card">
			<h2>Motion</h2>
			<div class="motion-wrap">
				<div class="pad">
					<button onpointerdown="startMotion('forward_left')">↖</button>
					<button onpointerdown="startMotion('forward')">▲</button>
					<button onpointerdown="startMotion('forward_right')">↗</button>
					<button onpointerdown="startMotion('left')">◀</button>
					<button onpointerdown="stopMotion()">■</button>
					<button onpointerdown="startMotion('right')">▶</button>
					<button onpointerdown="startMotion('backward_left')">↙</button>
					<button onpointerdown="startMotion('backward')">▼</button>
					<button onpointerdown="startMotion('backward_right')">↘</button>
				</div>
				<div class="speed-box">
					<label for="speedRange">Speed</label>
					<input id="speedRange" type="range" min="60" max="255" value="185" oninput="updateSpeed(this.value)" />
					<div class="speed-value" id="speedValue">185</div>
				</div>
			</div>
		</div>

		<div class="card">
			<h2>Head</h2>
			<div class="row">
				<button onclick="send('head','left')">Left</button>
				<button onclick="send('head','center')">Center</button>
				<button onclick="send('head','right')">Right</button>
			</div>
		</div>

		<div class="arms-grid">
			<div class="card">
				<h2>Left Arm</h2>
				<div class="arm-col">
					<button onclick="send('left_arm','up')">Up</button>
					<button onclick="send('left_arm','center')">Center</button>
					<button onclick="send('left_arm','down')">Down</button>
				</div>
			</div>

			<div class="card">
				<h2>Right Arm</h2>
				<div class="arm-col">
					<button onclick="send('right_arm','up')">Up</button>
					<button onclick="send('right_arm','center')">Center</button>
					<button onclick="send('right_arm','down')">Down</button>
				</div>
			</div>
		</div>

		<div class="card">
			<h2>Modes</h2>
			<div class="row">
				<button onclick="sendSystem('autonomous_on')">Autonomous ON</button>
				<button onclick="sendSystem('autonomous_off')">Autonomous OFF</button>
				<button onclick="sendSystem('pose_on')">Pose ON</button>
			</div>
			<div class="row" style="margin-top: 8px;">
				<button onclick="sendSystem('pose_off')">Pose OFF</button>
				<span class="empty">-</span>
				<span class="empty">-</span>
			</div>
		</div>

		<div class="status" id="status">Last command: none</div>
	</div>

	<script>
		let activeMotion = null;
		let motionSpeed = 185;
		let lastCommand = 'none';
		let autoDrive = true;
		let autoPose = true;

		function setStatusText(text) {
			document.getElementById('status').textContent = text;
		}

		function mapMotion(action) {
			if (action === 'forward') return 'MOTION FORWARD';
			if (action === 'backward') return 'MOTION BACKWARD';
			if (action === 'left') return 'MOTION LEFT';
			if (action === 'right') return 'MOTION RIGHT';
			if (action === 'forward_left') return 'MOTION FORWARD_LEFT';
			if (action === 'forward_right') return 'MOTION FORWARD_RIGHT';
			if (action === 'backward_left') return 'MOTION BACKWARD_LEFT';
			if (action === 'backward_right') return 'MOTION BACKWARD_RIGHT';
			if (action === 'stop') return 'MOTION STOP';
			return 'UNKNOWN';
		}

		function mapServo(target, action) {
			if (target === 'head') {
				if (action === 'left') return 'SERVO HEAD LEFT';
				if (action === 'center') return 'SERVO HEAD CENTER';
				if (action === 'right') return 'SERVO HEAD RIGHT';
			}
			if (target === 'left_arm') {
				if (action === 'up') return 'SERVO LEFT_ARM UP';
				if (action === 'center') return 'SERVO LEFT_ARM CENTER';
				if (action === 'down') return 'SERVO LEFT_ARM DOWN';
			}
			if (target === 'right_arm') {
				if (action === 'up') return 'SERVO RIGHT_ARM UP';
				if (action === 'center') return 'SERVO RIGHT_ARM CENTER';
				if (action === 'down') return 'SERVO RIGHT_ARM DOWN';
			}
			return 'UNKNOWN';
		}

		function mapSystem(action) {
			if (action === 'autonomous_on') {
				autoDrive = true;
				return 'SYSTEM AUTONOMOUS ON';
			}
			if (action === 'autonomous_off') {
				autoDrive = false;
				return 'SYSTEM AUTONOMOUS OFF';
			}
			if (action === 'pose_on') {
				autoPose = true;
				return 'SYSTEM POSE ON';
			}
			if (action === 'pose_off') {
				autoPose = false;
				return 'SYSTEM POSE OFF';
			}
			return 'UNKNOWN';
		}

		async function send(target, action) {
			if (target === 'motion') {
				lastCommand = mapMotion(action);
				autoDrive = false;
			} else if (target === 'head' || target === 'left_arm' || target === 'right_arm') {
				lastCommand = mapServo(target, action);
				autoPose = false;
			} else {
				lastCommand = 'UNKNOWN';
			}
			setStatusText(`Last command: ${lastCommand}`);
		}

		async function sendSystem(action) {
			lastCommand = mapSystem(action);
			setStatusText(`Last command: ${lastCommand}`);
		}

		async function sendMotion(action) {
			await send('motion', action);
		}

		function updateSpeed(value) {
			motionSpeed = Number(value);
			document.getElementById('speedValue').textContent = String(motionSpeed);
		}

		async function startMotion(action) {
			if (activeMotion === action) return;
			activeMotion = action;
			await sendMotion(action);
		}

		async function stopMotion() {
			if (activeMotion === null) return;
			activeMotion = null;
			await sendMotion('stop');
		}

		function refreshStatus() {
			setStatusText(`last=${lastCommand} | auto_drive=${autoDrive ? 'on' : 'off'} | auto_pose=${autoPose ? 'on' : 'off'} (local preview)`);
		}

		document.addEventListener('pointerup', stopMotion);
		document.addEventListener('pointercancel', stopMotion);
		window.addEventListener('blur', stopMotion);

		refreshStatus();
		setInterval(refreshStatus, 1000);
	</script>
</body>
</html>
